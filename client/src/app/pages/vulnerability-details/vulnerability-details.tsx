import React from "react";
import { Link } from "react-router-dom";

import {
  Breadcrumb,
  BreadcrumbItem,
  PageSection,
} from "@patternfly/react-core";

import DetailsPage from "@patternfly/react-component-groups/dist/dynamic/DetailsPage";

import { PathParam, useRouteParams } from "@app/Routes";
import { useFetchVulnerabilities } from "@app/queries/vulnerabilities";

export const PackageDetails: React.FC = () => {
  const vulnerabilityId = useRouteParams(PathParam.VULNERABILITY_ID);

  const { isFetching, vulnerabilities, fetchError } = useFetchVulnerabilities();

  const vulnerability = React.useMemo(() => {
    return vulnerabilities
      .flatMap((p) => p.vulnerabilityIDs)
      .find((e) => e.id === vulnerabilityId);
  }, [vulnerabilities]);

  return (
    <>
      <PageSection variant="light">
        <DetailsPage
          breadcrumbs={
            <Breadcrumb>
              <BreadcrumbItem key="vulnerabilities">
                <Link to="/vulnerabilities">Vulnerabilities</Link>
              </BreadcrumbItem>
              <BreadcrumbItem to="#" isActive>
                Vulnerability details
              </BreadcrumbItem>
            </Breadcrumb>
          }
          pageHeading={{
            title: vulnerability?.vulnerabilityID ?? vulnerabilityId ?? "",
          }}
          actionButtons={[]}
          tabs={[
            {
              eventKey: "sboms",
              title: "SBOMs",
              children: (
                <div className="pf-v5-u-m-md">
                  SBOMs affected by current Vulnerability
                </div>
              ),
            },
            {
              eventKey: "packages",
              title: "Packages",
              children: (
                <div className="pf-v5-u-m-md">
                  Packages affected by current Vulnerability
                </div>
              ),
            },
          ]}
        />
      </PageSection>
    </>
  );
};
